<!DOCTYPE html>
<html>

<head>
    <title>Checklist Ambulanza</title>
    <!-- Aggiunta dei file CSS e JS di Bootstrap e della libreria jQuery -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /* Stili per la formattazione della pagina */
        body {
            font-family: Arial, sans-serif;
        }

        h1 {
            margin-bottom: 20px;
        }

        .macro-location {
            margin-bottom: 20px;
            margin-left: 30px;
        }

        .location {
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 10px;
        }

        table {
            border-collapse: collapse;
            width: 90%;
        }

        th,
        td {
            text-align: left;
            padding: 8px;
            border: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        label {
            margin-left: 10px;
        }

        th:first-child,
        td:first-child {
            width: 40%;
            max-width: 300px;
        }
    </style>
</head>

<body>
    <!-- Creazione del menu usando il componente di navigazione di Bootstrap -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">SmartEmergencyChecklist</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#">Esegui checklist</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1>Esegui checklist ambulanza</h1>

        <!-- Container per le macro posizioni -->
        <div id="macro-locations-container"></div>
    </div>

    <script>
        // Funzione per creare un elemento HTML checkbox
        function createCheckbox(id) {
            var checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = id;
            checkbox.name = id;
            return checkbox;
        }

        // Connessione al database e query per ottenere i dati
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'http://localhost/checklist', true);
        xhr.onreadystatechange = function () {
            if (this.readyState === 4 && this.status === 200) {
                var data = JSON.parse(this.responseText);

                // Ciclo per creare gli elementi HTML per le macro posizioni
                for (var i = 0; i < data.macro_locations.length; i++) {
                    var macroLocation = data.macro_locations[i];

                    var macroLocationDiv = document.createElement('div');
                    macroLocationDiv.classList.add('macro-location');

                    var macroLocationTitle = document.createElement('h2');
                    macroLocationTitle.textContent = macroLocation.macro_location_name;

                    macroLocationDiv.appendChild(macroLocationTitle);

                    // Ciclo per creare gli elementi HTML per le posizioni
                    for (var j = 0; j < macroLocation.locations.length; j++) {
                        var location = macroLocation.locations[j];

                        var locationTable = document.createElement('table');
                        locationTable.classList.add('location');

                        var locationTitleRow = locationTable.insertRow(0);
                        var locationTitleCell = locationTitleRow.insertCell(0);
                        locationTitleCell.colSpan = '3';
                        locationTitleCell.textContent = location.location_name;

                        var objectHeaderRow = locationTable.insertRow(1);
                        var objectHeaderCell1 = objectHeaderRow.insertCell(0);
                        var objectHeaderCell2 = objectHeaderRow.insertCell(1);
                        var objectHeaderCell3 = objectHeaderRow.insertCell(2);
                        objectHeaderCell1.textContent = 'Oggetti';
                        objectHeaderCell2.textContent = 'QuantitÃ ';
                        objectHeaderCell3.textContent = 'Seleziona';

                        // Ciclo per creare gli elementi HTML per gli oggetti
                        for (var k = 0; k < location.location_objects.length; k++) {
                            var object = location.location_objects[k];

                            var objectRow = locationTable.insertRow();
                            var objectCell1 = objectRow.insertCell(0);
                            var objectCell2 = objectRow.insertCell(1);
                            var objectCell3 = objectRow.insertCell(2);

                            objectCell1.textContent = object.object_name;
                            objectCell2.textContent = object.object_quantity;

                            var checkboxLabel = document.createElement('label');
                            checkboxLabel.for = object.object_name;
                            checkboxLabel.appendChild(createCheckbox(object.object_name));

                            objectCell3.appendChild(checkboxLabel);
                        }

                        macroLocationDiv.appendChild(locationTable);
                    }

                    document.getElementById('macro-locations-container').appendChild(macroLocationDiv);
                }
            }
        };
        xhr.send();
    </script>


</body>

</html>